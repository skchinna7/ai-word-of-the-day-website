<!DOCTYPE html>
<html>
<head>
    <!-- Character encoding -->
    <meta charset="UTF-8">
    <!-- Viewport for responsive design -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <meta name="title" content="Word of the Day - Learn New Words Daily">
    <!-- Page description for search engines -->
    <meta name="description" content="Discover a new word every day with definitions, examples, and pronunciation guides.">
    <!-- Keywords (less important now) -->
    <meta name="keywords" content="word of the day, vocabulary, learning, english words, dictionary">
    <!-- Author -->
    <meta name="author" content="Your Name or Organization">
    <!-- Robots directive -->
    <meta name="robots" content="index, follow">
    <!-- Open Graph protocol -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.wotd.in/">
    <meta property="og:title" content="Word of the Day - Learn New Words Daily">
    <meta property="og:description" content="Discover a new word every day with definitions, examples, and pronunciation guides.">
    <meta property="og:image" content="https://www.wotd.in/images/logo.jpg">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://www.wotd.in/">
    <meta name="twitter:title" content="Word of the Day - Learn New Words Daily">
    <meta name="twitter:description" content="Discover a new word every day with definitions, examples, and pronunciation guides.">
    <meta name="twitter:image" content="https://www.wotd.in/images/logo.jpg">
        <!-- Prevent XSS attacks -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Cache control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">    
    <!-- Favicon -->
    <link rel="icon" type="image/jpg" href="images/logo.jpg">
    <link rel="icon" type="image/jpg" href="images/logo.jpg" sizes="32x32">
    <link rel="stylesheet" href="css/login.css">
    <link rel="canonical" href="https://www.wotd.in/index/">
    <link rel="alternate" hreflang="es" href="https://www.wotd.in/es/">
    <link rel="alternate" hreflang="fr" href="https://www.wotd.in/fr/">
</head>
<body>
    <div class="box">
        <h1>Word of the Day</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('login')">Login</button>
            <button class="tab" onclick="showTab('signup')">Sign Up</button>
        </div>
        
        <div id="login" class="form active">
            <input type="email" id="loginEmail" placeholder="Email" autocomplete="email">
            <input type="password" id="loginPass" placeholder="Password" autocomplete="current-password">
            <button onclick="handleLogin()" id="loginBtn">Login</button>
            <div id="loginMsg" class="msg"></div>
        </div>
        
        <div id="signup" class="form">
            <input type="email" id="signupEmail" placeholder="Email" autocomplete="email">
            <input type="password" id="signupPass" placeholder="Password (6+ chars)" autocomplete="new-password">
            <button onclick="handleSignup()" id="signupBtn">Create Account</button>
            <div id="signupMsg" class="msg"></div>
        </div>
        
        <a href="index.html">← Back to Home</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const sb = window.supabase.createClient(
            "https://qzatavslhtkioivemwlk.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6YXRhdnNsaHRraW9pdmVtd2xrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MzIyMTYsImV4cCI6MjA4NjEwODIxNn0.LaNyj8T6VYGMMbuyX-Fg_6Fm6yIhPLTW0enYd6sNdGE",
            {
                auth: {
                    persistSession: true,
                    autoRefreshToken: true,
                    detectSessionInUrl: true
                }
            }
        );
        
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form').forEach(f => f.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }
        
        async function handleLogin() {
            const btn = document.getElementById('loginBtn');
            const msg = document.getElementById('loginMsg');
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPass').value;
            
            if (!email || !password) {
                msg.textContent = '❌ Please fill all fields';
                msg.className = 'msg error';
                msg.style.display = 'block';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Logging in...';
            
            try {
                const { data, error } = await sb.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                msg.textContent = '✅ Login successful!';
                msg.className = 'msg success';
                msg.style.display = 'block';
                
                // Wait a bit then redirect
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                
            } catch (error) {
                console.error('Login error:', error);
                msg.textContent = '❌ ' + error.message;
                msg.className = 'msg error';
                msg.style.display = 'block';
                btn.disabled = false;
                btn.textContent = 'Login';
            }
        }
        
        async function handleSignup() {
            const btn = document.getElementById('signupBtn');
            const msg = document.getElementById('signupMsg');
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPass').value;
            
            if (!email || !password) {
                msg.textContent = '❌ Please fill all fields';
                msg.className = 'msg error';
                msg.style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                msg.textContent = '❌ Password must be 6+ characters';
                msg.className = 'msg error';
                msg.style.display = 'block';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Creating account...';
            
            try {
                const { data, error } = await sb.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) {
                    // Check for duplicate email
                    if (error.message.includes('already registered') || error.message.includes('already exists')) {
                        throw new Error('This email is already registered. Please login instead.');
                    }
                    throw error;
                }
                
                msg.textContent = '✅ Account created! Switching to login...';
                msg.className = 'msg success';
                msg.style.display = 'block';
                
                // Auto-switch to login tab
                setTimeout(() => {
                    showTab('login');
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('signupEmail').value = '';
                    document.getElementById('signupPass').value = '';
                    btn.disabled = false;
                    btn.textContent = 'Create Account';
                }, 2000);
                
            } catch (error) {
                console.error('Signup error:', error);
                msg.textContent = '❌ ' + error.message;
                msg.className = 'msg error';
                msg.style.display = 'block';
                btn.disabled = false;
                btn.textContent = 'Create Account';
            }
        }
        
        // Allow Enter key to submit
        document.getElementById('loginEmail').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleLogin();
        });
        document.getElementById('loginPass').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleLogin();
        });
        document.getElementById('signupEmail').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleSignup();
        });
        document.getElementById('signupPass').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleSignup();
        });
    </script>
</body>
</html>