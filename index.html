<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word of the Day</title>
    <link rel="icon" type="image/jpg" href="images/logo.jpg">
    <link rel="stylesheet" href="css/main.css">
</head>
<body class="dark">
    <div class="container">
        <div class="header">
            <a href="index.html" class="logo-container">
                <img src="images/logo.jpg" alt="Logo" class="logo-image">
                <div>
                    <div class="logo-text">Word of the Day</div>
                    <span class="logo-tagline">Expand your vocabulary daily</span>
                </div>
            </a>
            <div class="controls" id="headerControls">
                <a href="login.html" class="btn">üîê Login</a>
                <div class="theme-toggle" id="themeToggle"></div>
                <a href="about.html" class="btn">‚ÑπÔ∏è About</a>
            </div>
        </div>

        <!-- Stats Banner -->
        <div class="stats-banner">
            <div class="stat-box">
                <div class="stat-number" id="totalWords">...</div>
                <div class="stat-label">Total Words</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalViews">...</div>
                <div class="stat-label">Total Views</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalSubscribers">...</div>
                <div class="stat-label">Subscribers</div>
            </div>
        </div>

        <!-- Today's Word -->
        <div class="word-section">
            <div class="word-card">
                <div class="word" id="word">Loading...</div>
                <div class="phonetic" id="phonetic"></div>
                <div class="pronunciation" id="pronunciation"></div>
                <span class="part-of-speech-badge" id="partOfSpeech" style="display: none;"></span>
                <div class="stats" id="stats"></div>
            </div>
            
            <div class="meaning-card">
                <div class="meaning" id="meaning"></div>
                
                <div class="syn-ant-section" id="synonymsSection" style="display: none;">
                    <h3 class="syn-ant-title">üìó Synonyms</h3>
                    <div class="syn-ant-list" id="synonyms"></div>
                </div>
                
                <div class="syn-ant-section" id="antonymsSection" style="display: none;">
                    <h3 class="syn-ant-title">üìï Antonyms</h3>
                    <div class="syn-ant-list" id="antonyms"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2026 Word of the Day</p>
            <p id="timezoneInfo"></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    console.log('üöÄ Starting app...');

    // Config
    const CONFIG = {
        url: "https://qzatavslhtkioivemwlk.supabase.co",
        key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6YXRhdnNsaHRraW9pdmVtd2xrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MzIyMTYsImV4cCI6MjA4NjEwODIxNn0.LaNyj8T6VYGMMbuyX-Fg_6Fm6yIhPLTW0enYd6sNdGE"
    };

    // Initialize
    const { createClient } = window.supabase;
    const supabase = createClient(CONFIG.url, CONFIG.key);
    console.log('‚úÖ Supabase initialized');

    // Theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.className = savedTheme;
    const themeToggle = document.getElementById('themeToggle');
    if (savedTheme === 'dark') themeToggle.classList.add('active');
    themeToggle.onclick = () => {
        const isDark = document.body.classList.contains('dark');
        document.body.className = isDark ? 'light' : 'dark';
        themeToggle.classList.toggle('active');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
    };

    // Load stats
    async function loadStats() {
        console.log('üìä Loading stats...');
        
        try {
            const { data: words, error: e1 } = await supabase.from('words').select('id, views');
            console.log('Words result:', words, e1);
            
            if (e1) {
                console.error('‚ùå Words error:', e1);
                document.getElementById('totalWords').textContent = '?';
                document.getElementById('totalViews').textContent = '?';
            } else {
                const count = words ? words.length : 0;
                const views = words ? words.reduce((sum, w) => sum + (w.views || 0), 0) : 0;
                
                console.log('‚úÖ Words:', count, 'Views:', views);
                
                document.getElementById('totalWords').textContent = count;
                document.getElementById('totalViews').textContent = views;
            }
            
            const { data: subs, error: e2 } = await supabase.from('subscribers').select('id');
            console.log('Subs result:', subs, e2);
            
            if (e2) {
                console.error('‚ùå Subs error:', e2);
                document.getElementById('totalSubscribers').textContent = '?';
            } else {
                const subCount = subs ? subs.length : 0;
                console.log('‚úÖ Subscribers:', subCount);
                document.getElementById('totalSubscribers').textContent = subCount;
            }
            
        } catch (err) {
            console.error('‚ùå Stats failed:', err);
        }
    }

    // Load word
    async function loadWord() {
        console.log('üìù Loading word...');
        
        try {
            const today = new Date().toISOString().split('T')[0];
            console.log('Today:', today);
            
            const { data: words, error } = await supabase
                .from('words')
                .select('*')
                .eq('scheduled_for', today)
                .limit(1);
            
            console.log('Word result:', words, error);
            
            if (error) {
                console.error('‚ùå Word error:', error);
                document.getElementById('word').textContent = 'Error';
                document.getElementById('meaning').textContent = error.message;
                return;
            }
            
            if (!words || words.length === 0) {
                console.log('No word for today, getting latest...');
                const { data: latest } = await supabase
                    .from('words')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(1);
                
                if (!latest || latest.length === 0) {
                    document.getElementById('word').textContent = 'No Words Yet';
                    document.getElementById('meaning').textContent = 'Add some words in admin!';
                    return;
                }
                
                displayWord(latest[0]);
            } else {
                displayWord(words[0]);
            }
            
        } catch (err) {
            console.error('‚ùå Word failed:', err);
        }
    }

    function displayWord(word) {
        console.log('Displaying:', word.word);
        document.getElementById('word').textContent = word.word;
        document.getElementById('meaning').textContent = word.meaning;
        document.getElementById('phonetic').textContent = word.phonetic || '';
        document.getElementById('pronunciation').textContent = word.pronunciation || '';
        
        if (word.part_of_speech) {
            document.getElementById('partOfSpeech').textContent = word.part_of_speech;
            document.getElementById('partOfSpeech').style.display = 'inline-block';
        }
        
        document.getElementById('stats').innerHTML = `
            <div class="stat-item">üëÅÔ∏è ${word.views || 0} views</div>
        `;
    }

    // Timezone
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    document.getElementById('timezoneInfo').textContent = `üåç ${tz}`;

    // Run
    (async () => {
        await loadStats();
        await loadWord();
        console.log('‚úÖ Done!');
    })();
    </script>
</body>
</html>